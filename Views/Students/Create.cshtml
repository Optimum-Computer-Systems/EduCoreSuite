@model EduCoreSuite.Models.Student
@{
    ViewData["Title"] = "Create";
    var maxDOB = DateTime.Today.AddYears(-17).ToString("yyyy-MM-dd");
}

<h2 class="mb-3">Create Student</h2>

<p>
    <a asp-controller="Students" asp-action="Index" class="btn btn-outline-secondary me-2">Student List</a>
</p>

<hr />

<form asp-action="Create" method="post">
    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

    <!-- ================= PERSONAL DETAILS ================= -->
    <h4>Personal Details</h4><hr />
    <div class="row g-3">
        <div class="col-md-6">
            <label asp-for="FullName" class="form-label"></label>
            <input asp-for="FullName" class="form-control" placeholder="John Doe" />
            <span asp-validation-for="FullName" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Email" class="form-label"></label>
            <input asp-for="Email" class="form-control" />
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="AdmissionNumber" class="form-label"></label>
            <input asp-for="AdmissionNumber" class="form-control" placeholder="ADM2024-001" />
            <span asp-validation-for="AdmissionNumber" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="DOB" class="form-label"></label>
            <input asp-for="DOB" type="date" class="form-control" max="@maxDOB" />
            <span asp-validation-for="DOB" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Nationality" class="form-label"></label>
            <input asp-for="Nationality" class="form-control" />
            <span asp-validation-for="Nationality" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="IDNumber" class="form-label"></label>
            <input asp-for="IDNumber" class="form-control" />
            <span asp-validation-for="IDNumber" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Gender" class="form-label"></label>
            <select asp-for="Gender" class="form-select">
                <option value="">-- Select Gender --</option>
                <option>Male</option>
                <option>Female</option>
            </select>
            <span asp-validation-for="Gender" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Religion" class="form-label"></label>
            <select asp-for="Religion" class="form-select">
                <option value="">-- Select Religion --</option>
                <option>Christian</option>
                <option>Muslim</option>
                <option>Hindu</option>
                <option>Other</option>
            </select>
            <span asp-validation-for="Religion" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Disability" class="form-label"></label>
            <select asp-for="Disability" class="form-select">
                <option value="">-- Disability? --</option>
                <option>Yes</option>
                <option>No</option>
            </select>
            <span asp-validation-for="Disability" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Medical" class="form-label"></label>
            <input asp-for="Medical" class="form-control" />
            <span asp-validation-for="Medical" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="MaritalStatus" class="form-label"></label>
            <select asp-for="MaritalStatus" class="form-select">
                <option value="">-- Marital Status --</option>
                <option>Single</option>
                <option>Married</option>
                <option>Divorced</option>
                <option>Widowed</option>
            </select>
            <span asp-validation-for="MaritalStatus" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="CoCurricular" class="form-label"></label>
            <input asp-for="CoCurricular" class="form-control" />
            <span asp-validation-for="CoCurricular" class="text-danger"></span>
        </div>
    </div>

    <!-- ================ CONTACT INFO =================== -->
    <h4 class="mt-4">Contact Info</h4><hr />
    <div class="row g-3">
        <div class="col-md-6">
            <label asp-for="PrimaryPhone" class="form-label"></label>
            <input asp-for="PrimaryPhone" class="form-control" />
            <span asp-validation-for="PrimaryPhone" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="AltPhone" class="form-label"></label>
            <input asp-for="AltPhone" class="form-control" />
            <span asp-validation-for="AltPhone" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="PostalCode" class="form-label"></label>
            <input asp-for="PostalCode" class="form-control" />
            <span asp-validation-for="PostalCode" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="CountyID" class="form-label">County</label>
            <select asp-for="CountyID" class="form-select" asp-items="ViewBag.Counties"></select>
            <span asp-validation-for="CountyID" class="text-danger"></span>
        
        </div>
        <div class="col-md-6">
            <label asp-for="SubCountyID" class="form-label">Sub‑county</label>
            <select asp-for="SubCountyID" class="form-select" asp-items="ViewBag.SubCounties"></select>
            <span asp-validation-for="SubCountyID" class="text-danger"></span>
        
        </div>
        <div class="col-md-6">
            <label asp-for="Town" class="form-label"></label>
            <input asp-for="Town" class="form-control" />
            <span asp-validation-for="Town" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Ward" class="form-label"></label>
            <input asp-for="Ward" class="form-control" />
            <span asp-validation-for="Ward" class="text-danger"></span>
        </div>
    </div>

    <!-- ============== EMERGENCY CONTACT =============== -->
    <h4 class="mt-4">Emergency Contact</h4><hr />
    <div class="row g-3">
        <div class="col-md-6">
            <label asp-for="EmergencyName" class="form-label"></label>
            <input asp-for="EmergencyName" class="form-control" />
            <span asp-validation-for="EmergencyName" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Relationship" class="form-label"></label>
            <select asp-for="Relationship" class="form-select">
                <option value="">-- Select --</option>
                <option>Father</option>
                <option>Mother</option>
                <option>Guardian</option>
                <option>Grandparent</option>
                <option>Sibling</option>
            </select>
            <span asp-validation-for="Relationship" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="EmergencyPhone" class="form-label"></label>
            <input asp-for="EmergencyPhone" class="form-control" />
            <span asp-validation-for="EmergencyPhone" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="EmergencyEmail" class="form-label"></label>
            <input asp-for="EmergencyEmail" class="form-control" />
            <span asp-validation-for="EmergencyEmail" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="EmergencyAddress" class="form-label"></label>
            <input asp-for="EmergencyAddress" class="form-control" />
            <span asp-validation-for="EmergencyAddress" class="text-danger"></span>
        </div>
    </div>

    <!-- =============== ACADEMIC DETAILS ================ -->
    <h4 class="mt-4">Academic Details</h4><hr />
    <div class="row g-3">
        <div class="col-md-6">
            <label asp-for="Course" class="form-label"></label>
            <select asp-for="Course" class="form-select" asp-items="ViewBag.Courses"></select>
            <span asp-validation-for="Course" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Department" class="form-label"></label>
            <select asp-for="Department" class="form-select" asp-items="ViewBag.Departments"></select>
            <span asp-validation-for="Department" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Faculty" class="form-label"></label>
            <select asp-for="Faculty" class="form-select" asp-items="ViewBag.Faculties"></select>
            <span asp-validation-for="Faculty" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Program" class="form-label"></label>
            <select asp-for="Program" class="form-select">
                <option value="">-- Program --</option>
                <option>Certificate</option>
                <option>Diploma</option>
                <option>Degree</option>
                <option>Masters</option>
            </select>
            <span asp-validation-for="Program" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="ExamBody" class="form-label"></label>
            <select asp-for="ExamBody" class="form-select" asp-items="ViewBag.ExamBodies"></select>
            <span asp-validation-for="ExamBody" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Year" class="form-label"></label>
            <select asp-for="Year" class="form-select">
                <option value="">-- Select Year --</option>
                <option>1st Year</option>
                <option>2nd Year</option>
                <option>3rd Year</option>
                <option>4th Year</option>
            </select>
            <span asp-validation-for="Year" class="text-danger"></span>
        </div>
    </div>

    <!-- SUBMIT -->
    <div class="mt-4">
        <input type="submit" value="Add Student" class="btn btn-primary" />
    </div>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    <script>
        // --- grab the two dropdowns by their auto‑generated IDs ---
        const countySel = document.getElementById('CountyID');
        const subSel    = document.getElementById('SubCountyID');

        if (countySel && subSel) {
            console.log('County/Sub‑county handlers wired');   // ✅ sanity check

            countySel.addEventListener('change', () => {
                const id = countySel.value;

                // reset Sub‑county list but keep a placeholder
                subSel.innerHTML =
                    '<option value="">-- Select Sub‑county --</option>';

                if (!id) return;   // nothing chosen yet

                fetch(`/Students/GetSubCounties?countyId=${id}`)
                    .then(r => {
                        if (!r.ok) throw new Error('HTTP ' + r.status);
                        return r.json();
                    })
                    .then(list => {
                        console.log('Sub‑counties fetched:', list); // ✅
                        list.forEach(sc => {
                            const opt = document.createElement('option');
                            opt.value = sc.subCountyID ?? sc.SubCountyID ?? sc.id;
                            opt.text  = sc.subCountyName ?? sc.SubCountyName ?? sc.text;
                            subSel.appendChild(opt);
                        });
                    })
                    .catch(err => console.error('Sub‑county load failed →', err));
            });
        } else {
            console.error('Cannot find CountyID or SubCountyID controls in DOM');
        }
    </script>
}

    }
